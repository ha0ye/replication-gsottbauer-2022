---
title: "Supplementary-Survey1"
output: github_document
---

# Setup

First, load up the necessary packages. We are operating in interactive mode, so `{{tidyverse}}` can be used and is inclusive of `{{ggplot2}}`, `{{scales}}`, and `{{dplyr}}`.

```{r load packages}
library(readstata13)
library(psych)
library(tidyverse)
```

We don't need to set paths, and assume folks will follow the practice of using an RStudio project with the project folder as the main parent folder. All paths are thus local to that.

```{r set data paths}
datafile_survey_1 <- here::here("data", "MasterFile_Survey1.dta")



# load data - labels will be lost
df_study1<-read.dta13("Data_Survey1/MasterFile_Survey1.dta", convert.factors = T, nonint.factors = T)
```

## Survey 1 (German Internet Panel)

Replicate numbers for table 1. First table always poor, second is rich.

```{r}
describeBy(df_study1$income*1000, group=df_study1$rich)
describeBy(df_study1$male, group=df_study1$rich)
describeBy(df_study1$age, group=df_study1$rich)
describeBy(df_study1$edu, group=df_study1$rich)
describeBy(df_study1$married, group=df_study1$rich)
describeBy(df_study1$student, group=df_study1$rich)
describeBy(df_study1$religiousness, group=df_study1$rich)
describeBy(df_study1$east, group=df_study1$rich)
describeBy(df_study1$leftright, group=df_study1$rich)

```

We use the Wilcox-Rank-Sum test as a balance test for differences between groups.

```{r}
# Monthly Net Income (Euros) p=.7763
wilcox.test(df_study1$income[df_study1$rich==0],df_study1$income[df_study1$rich==1])
# Male p=.561
wilcox.test(df_study1$male[df_study1$rich==0],df_study1$male[df_study1$rich==1])
# Age p=0.06673
wilcox.test(df_study1$age[df_study1$rich==0],df_study1$age[df_study1$rich==1])
# Education p=.2622
wilcox.test(df_study1$edu[df_study1$rich==0],df_study1$edu[df_study1$rich==1])
# Married p=.09073
wilcox.test(df_study1$married[df_study1$rich==0],df_study1$married[df_study1$rich==1])
# Student p=.6752
wilcox.test(df_study1$student[df_study1$rich==0],df_study1$student[df_study1$rich==1])
# Religiousness p=.9615
wilcox.test(df_study1$religiousness[df_study1$rich==0],df_study1$religiousness[df_study1$rich==1])
# East German p=.9181
wilcox.test(df_study1$east[df_study1$rich==0],df_study1$east[df_study1$rich==1])
# Political Ideology p=.2446
wilcox.test(df_study1$leftright[df_study1$rich==0],df_study1$leftright[df_study1$rich==1]) # p=0.2446

```


## Figure A1.1

To create figure 1, first labels for income groups have to be assigned, then new data for plotting is created and then the data is plotted.

```{r}
# Create variable to differentiate by treatment group
df_study1$treatment<-"1. Treatment 1"
df_study1$treatment[df_study1$rich==1]<-"2. Treatment 2"

df_study1$income_lab<-0

# Create labeled variable in same data
df_study1$income_lab[is.na(df_study1$income)==TRUE]<-16
df_study1$income_lab[df_study1$income<=0.08]<-1
df_study1$income_lab[df_study1$income>0.08&df_study1$income<=0.28]<-2
df_study1$income_lab[df_study1$income>0.28&df_study1$income<=0.800]<-3
df_study1$income_lab[df_study1$income>0.8&df_study1$income<=1.3]<-4
df_study1$income_lab[df_study1$income==1.75]<-5
df_study1$income_lab[df_study1$income==2.25]<-6
df_study1$income_lab[df_study1$income==2.75]<-7
df_study1$income_lab[df_study1$income==3.25]<-8
df_study1$income_lab[df_study1$income==3.75]<-9
df_study1$income_lab[df_study1$income==4.25]<-10
df_study1$income_lab[df_study1$income==4.75]<-11
df_study1$income_lab[df_study1$income==5.25]<-12
df_study1$income_lab[df_study1$income==5.75]<-13
df_study1$income_lab[df_study1$income==6.75]<-14
df_study1$income_lab[df_study1$income==8.75]<-15

incomelabs<-c("less than 150 Euro",
              "150 to less than 400 Euro",
              "400 to less than 1000 Euro",
              "1000 to less than 1500 Euro",
              "1500 to less than 2000 Euro",
              "2000 to less than 2500 Euro",
              "2500 to less than 3000 Euro",
              "3000 to less than 3500 Euro",
              "3500 to less than 4000 Euro",
              "4000 to less than 4500 Euro",
              "4500 to less than 5000 Euro",
              "5000 to less than 5500 Euro",
              "5500 to less than 6000 Euro",
              "5000 to less than 7500 Euro",
              "7500 Euro and more",
              "No Information")

df_study1$income_lab<- as.numeric(df_study1$income_lab)
df_study1$income_lab<- as.factor(df_study1$income_lab)
levels(df_study1$income_lab)<-incomelabs

# create plot data
plot_data1 <- df_study1[is.na(df_study1$treatment)==F,] %>% 
  count(treatment, income_lab) %>% 
  group_by(income_lab) %>% 
  mutate(percent = n/sum(n))

# position of count
plot_data1$pos[plot_data1$treatment=="1. Treatment 1"]<-0.9
plot_data1$pos[plot_data1$treatment=="2. Treatment 2"]<-0.1


# create figure
d1<-ggplot(plot_data1, aes(income_lab,percent))

d1+geom_bar(stat="identity",aes(fill=treatment))+
  scale_fill_manual(name="Treatment Group", labels=c("Primed-Poor", "Primed-Rich"),
                    values=c("1. Treatment 1"="grey38", "2. Treatment 2"="grey55"))+
  geom_text(data=plot_data1, aes(y=pos,label=n))+
  coord_flip()+
  ylab("Percent") + xlab("Income Group")

```